<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>4. HTTP stores • zarr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="4. HTTP stores">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">zarr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/01_zarr.html">1. Zarr for R</a></li>
    <li><a class="dropdown-item" href="../articles/02_array_basics.html">2. Working with arrays</a></li>
    <li><a class="dropdown-item" href="../articles/03_attributes.html">3. Working with attributes</a></li>
    <li><a class="dropdown-item" href="../articles/04_http.html">4. HTTP stores</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/R-CF/zarr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>4. HTTP stores</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/R-CF/zarr/blob/v0.2.0/vignettes/articles/04_http.Rmd" class="external-link"><code>vignettes/articles/04_http.Rmd</code></a></small>
      <div class="d-none name"><code>04_http.Rmd</code></div>
    </div>

    
    
<p>The <code>zarr</code> package can read online stores over HTTP,
meaning that Zarr stores published on a regular web site are accessible.
Access is read-only. Unfortunately, there is no uniform mechanism to
identify what Zarr arrays are published and where they are located on
the web site. This package supports three mechanisms to access HTTP
stores.</p>
<div class="section level2">
<h2 id="accessing-http-stores">Accessing HTTP stores<a class="anchor" aria-label="anchor" href="#accessing-http-stores"></a>
</h2>
<div class="section level3">
<h3 id="zarr-v-2-consolidated-metadata">Zarr v.2: Consolidated metadata<a class="anchor" aria-label="anchor" href="#zarr-v-2-consolidated-metadata"></a>
</h3>
<p>Zarr v.2 supports consolidated metadata, a JSON file called
<code>.zmetadata</code> in the root of the HTPP store which lists all
the groups and arrays present in the store. When a
<code>.zmetadata</code> file is present, it will be automatically read
and groups and arrays will be added to the <code>zarr</code> object to
represent the contents of the HTTP store.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Publicly accessible Zarr v.2 HTTP store with consolidated metadata</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/open_zarr.html">open_zarr</a></span><span class="op">(</span><span class="st">"https://data.earthdatahub.destine.eu/public/test-dataset-v0.zarr"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: curl</span></span>
<span><span class="va">z</span><span class="op">$</span><span class="fu">hierarchy</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Zarr hierarchy&gt; https://data.earthdatahub.destine.eu/public/test-dataset-v0.zarr </span></span>
<span><span class="co">#&gt; ☰ / (root group)</span></span>
<span><span class="co">#&gt; ├ ⌗ age_band_lower_bound</span></span>
<span><span class="co">#&gt; ├ ⌗ demographic_totals</span></span>
<span><span class="co">#&gt; ├ ⌗ latitude</span></span>
<span><span class="co">#&gt; ├ ⌗ longitude</span></span>
<span><span class="co">#&gt; └ ⌗ year</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="single-array-store">Single-array store<a class="anchor" aria-label="anchor" href="#single-array-store"></a>
</h3>
<p>If there is no consolidated metadata, the HTTP store will be queried
for a <code>zarr.json</code> (v.3) or <code>.zarray</code> (v.2) JSON
file, containing the description of a single Zarr array. If found, the
array will added to the <code>zarr</code> object. The array may have
attributes that describe the properties of the array, such as
coordinates of the axes. These attributes have to be examined manually;
the Zarr specification has no standards for attribute contents.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/open_zarr.html">open_zarr</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/R-CF/zarr/main/inst/extdata/africa.zarr/tas"</span><span class="op">)</span></span>
<span><span class="va">z</span><span class="op">[[</span><span class="st">"/"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; &lt;Zarr array&gt;  </span></span>
<span><span class="co">#&gt; Path      : / </span></span>
<span><span class="co">#&gt; Data type : float32 </span></span>
<span><span class="co">#&gt; Shape     : 160 260 12 </span></span>
<span><span class="co">#&gt; Chunking  : 80 65 12 </span></span>
<span><span class="co">#&gt; Attributes:</span></span>
<span><span class="co">#&gt;  name      value                   </span></span>
<span><span class="co">#&gt;  long_name near-surface temperature</span></span>
<span><span class="co">#&gt;  units     degrees Celsius</span></span></code></pre></div>
<p>The downside of this approach is that you need to have knowledge of
the Zarr resource to be able to properly interpret the data.</p>
</div>
<div class="section level3">
<h3 id="group">Group<a class="anchor" aria-label="anchor" href="#group"></a>
</h3>
<p>When there is no consolidated metadata or a single array at the root
of the HTTP store, a group is expected as the final option. The group
should have attributes that explain what is contained in the store.</p>
<p>The below example uses sample data from the <a href="https://www.openmicroscopy.org" class="external-link">Open Microscopy Environment</a>
(OME) who have published the <a href="https://ngff.openmicroscopy.org/specifications/index.html" class="external-link">OME-Zarr
specification</a> for Zarr stores. You need to understand that
specification to interpret the data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A publicly accessible OME-Zarr data set</span></span>
<span><span class="op">(</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/open_zarr.html">open_zarr</a></span><span class="op">(</span><span class="st">"https://uk1s3.embassy.ebi.ac.uk/idr/zarr/v0.4/idr0044A/4007801.zarr"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Zarr&gt;</span></span>
<span><span class="co">#&gt; Version   : 2 </span></span>
<span><span class="co">#&gt; Store     : HTTP store </span></span>
<span><span class="co">#&gt; Arrays    : 0 </span></span>
<span><span class="co">#&gt; Attributes:</span></span>
<span><span class="co">#&gt;  name        value                                             </span></span>
<span><span class="co">#&gt;  _creator    omero-zarr, 0.3.0                                 </span></span>
<span><span class="co">#&gt;  multiscales list(axes = list(list(name = "t", type = "time"...</span></span>
<span><span class="co">#&gt;  omero       list(list(active = TRUE, coefficient = 1, color...</span></span>
<span></span>
<span><span class="co"># The attribute "multiscales" indicates the details of the data sets in the store</span></span>
<span><span class="co"># The "path" element is the path to the individual arrays</span></span>
<span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/prettify.html" class="external-link">prettify</a></span><span class="op">(</span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">z</span><span class="op">$</span><span class="va">root</span><span class="op">$</span><span class="va">attributes</span><span class="op">[[</span><span class="st">"multiscales"</span><span class="op">]</span><span class="op">]</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [</span></span>
<span><span class="co">#&gt;     {</span></span>
<span><span class="co">#&gt;         "axes": [</span></span>
<span><span class="co">#&gt;             {</span></span>
<span><span class="co">#&gt;                 "name": "t",</span></span>
<span><span class="co">#&gt;                 "type": "time"</span></span>
<span><span class="co">#&gt;             },</span></span>
<span><span class="co">#&gt;             {</span></span>
<span><span class="co">#&gt;                 "name": "c",</span></span>
<span><span class="co">#&gt;                 "type": "channel"</span></span>
<span><span class="co">#&gt;             },</span></span>
<span><span class="co">#&gt;             {</span></span>
<span><span class="co">#&gt;                 "name": "z",</span></span>
<span><span class="co">#&gt;                 "type": "space",</span></span>
<span><span class="co">#&gt;                 "unit": "micrometer"</span></span>
<span><span class="co">#&gt;             },</span></span>
<span><span class="co">#&gt;             {</span></span>
<span><span class="co">#&gt;                 "name": "y",</span></span>
<span><span class="co">#&gt;                 "type": "space",</span></span>
<span><span class="co">#&gt;                 "unit": "micrometer"</span></span>
<span><span class="co">#&gt;             },</span></span>
<span><span class="co">#&gt;             {</span></span>
<span><span class="co">#&gt;                 "name": "x",</span></span>
<span><span class="co">#&gt;                 "type": "space",</span></span>
<span><span class="co">#&gt;                 "unit": "micrometer"</span></span>
<span><span class="co">#&gt;             }</span></span>
<span><span class="co">#&gt;         ],</span></span>
<span><span class="co">#&gt;         "datasets": [</span></span>
<span><span class="co">#&gt;             {</span></span>
<span><span class="co">#&gt;                 "coordinateTransformations": [</span></span>
<span><span class="co">#&gt;                     {</span></span>
<span><span class="co">#&gt;                         "scale": [</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             1</span></span>
<span><span class="co">#&gt;                         ],</span></span>
<span><span class="co">#&gt;                         "type": "scale"</span></span>
<span><span class="co">#&gt;                     }</span></span>
<span><span class="co">#&gt;                 ],</span></span>
<span><span class="co">#&gt;                 "path": "0"</span></span>
<span><span class="co">#&gt;             },</span></span>
<span><span class="co">#&gt;             {</span></span>
<span><span class="co">#&gt;                 "coordinateTransformations": [</span></span>
<span><span class="co">#&gt;                     {</span></span>
<span><span class="co">#&gt;                         "scale": [</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             2,</span></span>
<span><span class="co">#&gt;                             2</span></span>
<span><span class="co">#&gt;                         ],</span></span>
<span><span class="co">#&gt;                         "type": "scale"</span></span>
<span><span class="co">#&gt;                     }</span></span>
<span><span class="co">#&gt;                 ],</span></span>
<span><span class="co">#&gt;                 "path": "1"</span></span>
<span><span class="co">#&gt;             },</span></span>
<span><span class="co">#&gt;             {</span></span>
<span><span class="co">#&gt;                 "coordinateTransformations": [</span></span>
<span><span class="co">#&gt;                     {</span></span>
<span><span class="co">#&gt;                         "scale": [</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             4,</span></span>
<span><span class="co">#&gt;                             4</span></span>
<span><span class="co">#&gt;                         ],</span></span>
<span><span class="co">#&gt;                         "type": "scale"</span></span>
<span><span class="co">#&gt;                     }</span></span>
<span><span class="co">#&gt;                 ],</span></span>
<span><span class="co">#&gt;                 "path": "2"</span></span>
<span><span class="co">#&gt;             },</span></span>
<span><span class="co">#&gt;             {</span></span>
<span><span class="co">#&gt;                 "coordinateTransformations": [</span></span>
<span><span class="co">#&gt;                     {</span></span>
<span><span class="co">#&gt;                         "scale": [</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             8,</span></span>
<span><span class="co">#&gt;                             8</span></span>
<span><span class="co">#&gt;                         ],</span></span>
<span><span class="co">#&gt;                         "type": "scale"</span></span>
<span><span class="co">#&gt;                     }</span></span>
<span><span class="co">#&gt;                 ],</span></span>
<span><span class="co">#&gt;                 "path": "3"</span></span>
<span><span class="co">#&gt;             },</span></span>
<span><span class="co">#&gt;             {</span></span>
<span><span class="co">#&gt;                 "coordinateTransformations": [</span></span>
<span><span class="co">#&gt;                     {</span></span>
<span><span class="co">#&gt;                         "scale": [</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             1,</span></span>
<span><span class="co">#&gt;                             16,</span></span>
<span><span class="co">#&gt;                             16</span></span>
<span><span class="co">#&gt;                         ],</span></span>
<span><span class="co">#&gt;                         "type": "scale"</span></span>
<span><span class="co">#&gt;                     }</span></span>
<span><span class="co">#&gt;                 ],</span></span>
<span><span class="co">#&gt;                 "path": "4"</span></span>
<span><span class="co">#&gt;             }</span></span>
<span><span class="co">#&gt;         ],</span></span>
<span><span class="co">#&gt;         "metadata": {</span></span>
<span><span class="co">#&gt;             "method": "loci.common.image.SimpleImageScaler",</span></span>
<span><span class="co">#&gt;             "version": "Bio-Formats 6.9.1"</span></span>
<span><span class="co">#&gt;         },</span></span>
<span><span class="co">#&gt;         "version": "0.4"</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt; ]</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co"># Open the array at path "3"</span></span>
<span><span class="va">z3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/open_zarr.html">open_zarr</a></span><span class="op">(</span><span class="st">"https://uk1s3.embassy.ebi.ac.uk/idr/zarr/v0.4/idr0044A/4007801.zarr/3"</span><span class="op">)</span></span>
<span><span class="va">z3</span><span class="op">[[</span><span class="st">"/"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; &lt;Zarr array&gt;  </span></span>
<span><span class="co">#&gt; Path      : / </span></span>
<span><span class="co">#&gt; Data type : uint16 </span></span>
<span><span class="co">#&gt; Shape     : 532 2 988 256 271 </span></span>
<span><span class="co">#&gt; Chunking  : 1 1 1 256 271</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="authentication">Authentication<a class="anchor" aria-label="anchor" href="#authentication"></a>
</h2>
<p>This package does not manage authentication for web resources.
Authentication comes in many different forms, including
supplier-specific protocols, and it is impossible to cater to them all.
More basic forms of authentication may use HTTP session tokens that are
inserted in the URL. If that is the case, you should manually get a
session token and then insert it into the URL that is used to open the
store in <code>zarr</code>.</p>
<p>For more complicated cases, it may be useful to write a small package
on top of <code>zarr</code> to manage authentication. We’d love to hear
of your efforts!</p>
</div>
<div class="section level2">
<h2 id="working-with-array-data-from-a-http-store">Working with array data from a HTTP store<a class="anchor" aria-label="anchor" href="#working-with-array-data-from-a-http-store"></a>
</h2>
<p>You can work with array data just like you would be array data from a
file system store: index it like any other R array. Keep in mind,
though, that the data will be fetched over your internet connection so
be very judicious in your indexing. Downloading a full array is almost
always a bad idea as Zarr arrays tend to be large. In the OME-Zarr
example above, there are
<code>532 * 2 * 988 * 256 * 271 = 72930271232</code> grid points, which
expands to about 271GB of integer data in R!</p>
<p>A more intelligent way to download data is to look at the chunking of
the array data. From the “axes” array in the “multiscales” attribute we
can see that a chunk (the unit of downloading data) is all of the “x”
and “y” extent for a single “[z, c, t]” tuple. The most efficient way of
downloading the data is then to follow the chunking scheme and download
one or a few of the “z”, “c” and “t” values and all of “x” and “y”.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Patrick Van Laake.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
